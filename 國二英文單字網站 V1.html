import React, { useState, useEffect, useCallback } from 'react';
import { Volume2, BookOpen, Brain, RotateCw, CheckCircle, XCircle, Trophy, ArrowRight, ArrowLeft, LayoutGrid } from 'lucide-react';

// å–®å…ƒè³‡æ–™åº« (å·²ç§»é™¤ Unit 1 & 2ï¼Œä¸¦æ›´æ–°æ¨™é¡Œ)
const textbookData = {
  3: {
    title: "Unit 3: The Animals Work Hard",
    words: [
      { word: "American", kk: "[É™Ë‹mÉ›rÉªkÉ™n]", pos: "n.", def: "ç¾åœ‹äºº", sentence: "Jack's wife is an American.", trans: "å‚‘å…‹çš„å¤ªå¤ªæ˜¯ç¾åœ‹äººã€‚", emoji: "ğŸ‡ºğŸ‡¸" },
      { word: "million", kk: "[Ë‹mÉªljÉ™n]", pos: "n.", def: "ç™¾è¬", sentence: "There are about 23 million people in Taiwan.", trans: "è‡ºç£ç´„æœ‰å…©åƒä¸‰ç™¾è¬äººã€‚", emoji: "ğŸ’°" },
      { word: "pound", kk: "[paÊŠnd]", pos: "n.", def: "ç£… (é‡é‡å–®ä½)", sentence: "The pork is on sale this week. It costs only two dollars a pound.", trans: "æœ¬é€±è±¬è‚‰æœ‰ç‰¹åƒ¹ã€‚ä¸€ç£…åªè¦åƒ¹å…©ç¾å…ƒã€‚", emoji: "âš–ï¸" },
      { word: "pick", kk: "[pÉªk]", pos: "v.", def: "æ¡æ‘˜ï¼›æ’¿æ‹¾", sentence: "When we climbed up the mountain, we picked some flowers along the way.", trans: "æˆ‘å€‘çˆ¬å±±æ™‚ï¼Œä¸€è·¯ä¸Šæ¡èŠ±ã€‚", emoji: "ğŸ¤" },
      { word: "bean", kk: "[bin]", pos: "n.", def: "è±†", sentence: "Roast chicken with green beans is the best dish at this restaurant.", trans: "çƒ¤é›ä½å››å­£è±†æ˜¯é€™å®¶é¤é¤¨çš„æœ€ä½³èœé¤šã€‚", emoji: "ğŸ«›" },
      { word: "cent", kk: "[sÉ›nt]", pos: "n.", def: "ç¾åˆ†", sentence: "He works very hard, but he only gets 80 cents an hour.", trans: "ä»–åŠªåŠ›å·¥ä½œï¼Œä½†ä»–åªè³ºå–æ™‚è–ªå…«åç¾åˆ†ã€‚", emoji: "ğŸª™" },
      { word: "chance", kk: "[tÊƒÃ¦ns]", pos: "n.", def: "æ©Ÿæœƒ", sentence: "These kids are poor. They don't even have a chance to go to school.", trans: "é€™äº›å­©ç«¥å¾ˆå¯æ†ã€‚ä»–å€‘ç”šè‡³æ²’æœ‰æ©Ÿæœƒä¸Šå­¸ã€‚", emoji: "ğŸ²" },
      { word: "choose", kk: "[tÊƒuz]", pos: "v.", def: "é¸æ“‡", sentence: "Teresa chose a red dress for the Christmas party.", trans: "ç‰¹ç‘èé¸äº†ä¸€ä»¶ç´…æ´‹è£åƒåŠ è€¶èª•æ´¾å°ã€‚", emoji: "ğŸ‘†" },
      { word: "hard", kk: "[hÉ‘rd]", pos: "adv.; adj.", def: "åŠªåŠ›åœ°ï¼›å›°é›£çš„", sentence: "Albert worked hard and made a lot of money.", trans: "äºä¼¯ç‰¹å·¥ä½œå‹¤å¥®ï¼Œè³ºäº†å¾ˆå¤šéŒ¢ã€‚", emoji: "ğŸ’ª" },
      { word: "well", kk: "[wÉ›l]", pos: "adv.", def: "å¥½åœ°", sentence: "Dad is old, and he can't hear very well.", trans: "çˆ¸çˆ¸å¹´ç´€å¤§äº†ï¼Œè€Œä¸”è½åŠ›ä¸å¤ªå¥½ã€‚", emoji: "ğŸ‘" },
      { word: "share", kk: "[ÊƒÉ›r]", pos: "v.", def: "åˆ†äº«", sentence: "I would like to share my stories about my days in Australia.", trans: "æˆ‘æƒ³è¦åˆ†äº«æˆ‘åœ¨æ¾³æ´²çš„ç”Ÿæ´»æ•…äº‹ã€‚", emoji: "ğŸ°" },
      { word: "weak", kk: "[wik]", pos: "adj.", def: "è™›å¼±çš„", sentence: "He felt weak when he traveled to India for vacation.", trans: "ç•¶ä»–åˆ°å°åº¦åº¦å‡æ™‚ï¼Œä»–æ„Ÿåˆ°è™›å¼±ã€‚", emoji: "ğŸ¥€" },
      { word: "hen", kk: "[hÉ›n]", pos: "n.", def: "æ¯é›", sentence: "We laughed when Jack walked like a hen.", trans: "ç•¶å‚‘å…‹åƒéš»æ¯é›èˆ¬èµ°è·¯æ™‚ï¼Œæˆ‘å€‘éƒ½ç¬‘äº†ã€‚", emoji: "ğŸ”" },
      { word: "dirty", kk: "[Ë‹dÉtÉª]", pos: "adj.", def: "é«’çš„", sentence: "Our hands, feet, and clothes were dirty after we played soccer.", trans: "è¸¢å®Œè¶³çƒå¾Œï¼Œæˆ‘å€‘çš„æ‰‹è…³å’Œè¡£æœéƒ½é«’äº†ã€‚", emoji: "ğŸ’©" },
      { word: "without", kk: "[wÉªË‹Ã°aÊŠt]", pos: "prep.", def: "æ²’æœ‰ï¼›ç„¡", sentence: "I left school without an umbrella, so I got wet when it rained.", trans: "æˆ‘é›¢é–‹å­¸æ ¡æ™‚æ²’å¸¶å‚˜ï¼Œæ‰€ä»¥ä¸‹é›¨æ™‚ï¼Œæˆ‘æ·‹æ¿•äº†ã€‚", emoji: "ğŸš«" },
      { word: "quickly", kk: "[Ë‹kwÉªklÉª]", pos: "adv.", def: "å¿«åœ°", sentence: "Bob, don't eat so quickly. It's bad for your health.", trans: "é®‘ä¼¯ï¼Œåˆ¥åƒé€™éº¼å¿«ã€‚é€™ä¸åˆ©æ–¼ä½ çš„å¥åº·ã€‚", emoji: "ğŸ†" },
      { word: "web page", kk: "[Ë‹wÉ›b ÍµpedÊ’]", pos: "n.", def: "ç¶²é ", sentence: "This web page looks terrible. There are too many colors.", trans: "é€™ç¶²é çœ‹èµ·ä¾†å¾ˆç³Ÿã€‚å¤ªå¤šè‰²å½©äº†ã€‚", emoji: "ğŸŒ" },
      { word: "service", kk: "[Ë‹sÉvÉªs]", pos: "n.", def: "æœå‹™", sentence: "The hotel provides good service.", trans: "é€™å®¶æ—…é¤¨æä¾›è‰¯å¥½çš„æœå‹™ã€‚", emoji: "ğŸ’" },
      { word: "clearly", kk: "[Ë‹klÉªrlÉª]", pos: "adv.", def: "æ¸…æ¥šåœ°", sentence: "We can see the fish in the river clearly because the water is clean.", trans: "æ°´å¾ˆä¹¾æ·¨ï¼Œæˆ‘å€‘å¯ä»¥æ¸…æ¥šåœ°çœ‹è¦‹æ²³è£¡çš„é­šã€‚", emoji: "ğŸ‘“" },
      { word: "No problem", kk: "[noË‹prÉ‘blÉ™m]", pos: "phr.", def: "æ²’å•é¡Œ", sentence: "A: Can you drive me to the airport later? B: Sure. No problem.", trans: "Aï¼šä½ å¾…æœƒå…’å¯ä»¥è¼‰æˆ‘åˆ°æ©Ÿå ´å—ï¼Ÿ Bï¼šç•¶ç„¶å¯ä»¥ã€‚æ²’å•é¡Œã€‚", emoji: "ğŸ‘Œ" },
      { word: "wise", kk: "[waÉªz]", pos: "adj.", def: "æ˜æ™ºçš„", sentence: "It is wise to think twice before you decide to do anything big.", trans: "åšä»»ä½•é‡å¤§æ±ºå®šæ™‚ï¼Œä¸‰æ€è€Œå¾Œè¡Œæ˜¯æ˜æ™ºçš„ã€‚", emoji: "ğŸ¦‰" },
      { word: "mean", kk: "[min]", pos: "adj.", def: "åˆ»è–„çš„ï¼›å…‡æƒ¡çš„", sentence: "Cinderella's sisters are mean to her.", trans: "ä»™æœç‘æ‹‰çš„å§Šå§Šå€‘å°å¥¹å¾ˆå£ã€‚", emoji: "ğŸ˜ˆ" },
      { word: "make", kk: "[mek]", pos: "v.", def: "è¦...åš...ï¼›ä½¿...", sentence: "Mom made my brother mop the floor and wipe the tables.", trans: "åª½åª½è¦æˆ‘å“¥å“¥æ‹–åœ°å’Œæ“¦æ¡Œå­ã€‚", emoji: "ğŸ”¨" },
      { word: "break", kk: "[brek]", pos: "n.", def: "ä¼‘æ¯", sentence: "At break, we usually share some snacks with each other.", trans: "æˆ‘å€‘å¸¸å¸¸åœ¨ä¼‘æ¯æ™‚é–“äº’ç›¸åˆ†äº«ä¸€äº›é›¶é£Ÿã€‚", emoji: "â˜•" },
      { word: "over", kk: "[Ë‹ovÉš]", pos: "prep.", def: "è¶…é", sentence: "Yesterday, Jerry worked over twelve hours. He looked really tired.", trans: "å‚‘ç‘æ˜¨å¤©å·¥ä½œè¶…éåäºŒå€‹å°æ™‚ã€‚ä»–çœ‹èµ·ä¾†çœŸçš„å¾ˆç–²å€¦ã€‚", emoji: "ğŸ“ˆ" },
      { word: "treat", kk: "[trit]", pos: "v.", def: "å°å¾…", sentence: "Our teacher treats all the students the same.", trans: "æˆ‘å€‘è€å¸«åŒæ¨£åœ°å°å¾…æ‰€æœ‰çš„å­¸ç”Ÿã€‚", emoji: "ğŸ¤" },
      { word: "take... down", kk: "[Íµtek Ë‹daÊŠn]", pos: "phr.", def: "ä½¿...å®è‡ºï¼›æ‹†é™¤", sentence: "They are going to take the old house down and build a new one.", trans: "ä»–å€‘æ‰“ç®—æ‹†é™¤é‚£æ£Ÿè€æˆ¿å­ï¼Œä¸¦å»ºé€ ä¸€æ£Ÿæ–°çš„ã€‚", emoji: "ğŸ—ï¸" },
      { word: "have", kk: "[hÃ¦v]", pos: "v.", def: "ä½¿... (ä½¿å½¹å‹•è©)", sentence: "I'll have my secretary give you a call in ten minutes.", trans: "æˆ‘æœƒå©å’æˆ‘çš„ç¥•æ›¸ååˆ†é˜ä¹‹å¾Œæ‰“é›»è©±çµ¦ä½ ã€‚", emoji: "ğŸ—£ï¸" },
    ]
  },
  4: {
    title: "Unit 4: I Can Hear the Wind Blow",
    words: [
      { word: "typhoon", kk: "[taÉªË‹fun]", pos: "n.", def: "é¢±é¢¨", sentence: "The typhoon season falls between July and September in Taiwan.", trans: "ä¸ƒæœˆåˆ°ä¹æœˆåœ¨è‡ºç£æ˜¯é¢±é¢¨å­£ç¯€ã€‚", emoji: "ğŸŒ€" },
      { word: "rose", kk: "[roz]", pos: "n.", def: "ç«ç‘°èŠ±", sentence: "On Valentine's Day, Judy's husband gave her a red rose and a card.", trans: "æƒ…äººç¯€é‚£å¤©ï¼ŒèŒ±è’‚çš„å…ˆç”Ÿçµ¦äº†å¥¹ä¸€æœµç´…ç«ç‘°å’Œä¸€å¼µå¡ç‰‡ã€‚", emoji: "ğŸŒ¹" },
      { word: "balcony", kk: "[Ë‹bÃ¦lkÉ™nÉª]", pos: "n.", def: "é™½å°", sentence: "She is hanging the clothes on the balcony.", trans: "å¥¹æ­£åœ¨æŠŠè¡£æœæ™¾åœ¨é™½è‡ºä¸Šã€‚", emoji: "ğŸ™ï¸" },
      { word: "must", kk: "[mÊŒst]", pos: "aux.", def: "å¿…é ˆï¼›ä¸€å®š", sentence: "For your own safety, you must follow the rules when driving.", trans: "ç‚ºäº†ä½ è‡ªèº«çš„å®‰å…¨ï¼Œä½ åœ¨é–‹è»Šæ™‚å¿…é ˆéµå®ˆè¦å‰‡ã€‚", emoji: "âš ï¸" },
      { word: "prepare", kk: "[prÉªË‹pÉ›r]", pos: "v.", def: "æº–å‚™", sentence: "She is preparing sandwiches, hamburgers, and orange juice for the picnic.", trans: "å¥¹æ­£åœ¨ç‚ºé‡é¤æº–å‚™ä¸‰æ˜æ²»ã€æ¼¢å ¡å’ŒæŸ³æ©™æ±ã€‚", emoji: "ğŸ’" },
      { word: "should", kk: "[ÊƒÊŠd]", pos: "aux.", def: "æ‡‰è©²", sentence: "You should wash your hands before you eat.", trans: "åƒæ±è¥¿ä¹‹å‰ä½ æ‡‰è©²è¦æ´—æ‰‹ã€‚", emoji: "â˜ï¸" },
      { word: "candle", kk: "[Ë‹kÃ¦nd!]", pos: "n.", def: "è Ÿç‡­", sentence: "The wind is really strong. It blows out the candle.", trans: "é¢¨çœŸçš„å¾ˆå¤§ã€‚å®ƒå¹æ»…äº†è Ÿç‡­ã€‚", emoji: "ğŸ•¯ï¸" },
      { word: "light", kk: "[laÉªt]", pos: "n.; v.", def: "ç‡ˆï¼›å…‰ï¼›é»äº®", sentence: "It's too dark here. Can you turn on the lights?", trans: "é€™è£¡å¤ªæš—äº†ã€‚ä½ å¯ä»¥é–‹ç‡ˆå—ï¼Ÿ", emoji: "ğŸ”¦" },
      { word: "myself", kk: "[maÉªË‹sÉ›lf]", pos: "pron.", def: "æˆ‘è‡ªå·±", sentence: "A: Who made this delicious cake? B: I made it by myself.", trans: "Aï¼šé€™å€‹ç¾å‘³çš„è›‹ç³•æ˜¯èª°åšçš„ï¼Ÿ Bï¼šæˆ‘è‡ªå·±åšçš„ã€‚", emoji: "ğŸ™‹" },
      { word: "yourself", kk: "[jÊŠrË‹sÉ›lf]", pos: "pron.", def: "ä½ è‡ªå·±", sentence: "Did you finish your math homework by yourself?", trans: "ä½ è‡ªå·±å®Œæˆæ•¸å­¸ä½œæ¥­äº†å—ï¼Ÿ", emoji: "ğŸ«µ" },
      { word: "radio", kk: "[Ë‹redÉªÍµo]", pos: "n.", def: "æ”¶éŸ³æ©Ÿï¼›å»£æ’­", sentence: "I sat in my car and turned on the radio.", trans: "æˆ‘ååœ¨è»Šè£¡ï¼Œä¸¦æ‰“é–‹æ”¶éŸ³æ©Ÿã€‚", emoji: "ğŸ“»" },
      { word: "news", kk: "[njuz]", pos: "n.", def: "æ–°èï¼›æ¶ˆæ¯", sentence: "There was news on the big earthquake last night.", trans: "æœ‰é—œæ–¼æ˜¨æ™šå¤§åœ°éœ‡çš„æ¶ˆæ¯ã€‚", emoji: "ğŸ“°" },
      { word: "if", kk: "[Éªf]", pos: "conj.", def: "å¦‚æœ", sentence: "If you come home late, I'll have dinner by myself.", trans: "å¦‚æœä½ å¾ˆæ™šå›å®¶ï¼Œæˆ‘å°±è‡ªå·±ä¸€å€‹äººåƒæ™šé¤ã€‚", emoji: "ğŸ¤”" },
      { word: "or", kk: "[É”r]", pos: "conj.", def: "å¦å‰‡", sentence: "We should leave now, or we'll be late for the movie.", trans: "æˆ‘å€‘ç¾åœ¨æ‡‰è©²è¦é›¢é–‹äº†ï¼Œå¦å‰‡æˆ‘å€‘çœ‹é›»å½±æœƒé²åˆ°ã€‚", emoji: "ğŸšª" },
      { word: "have to", kk: "[Ë‹hÃ¦v tÉ™]", pos: "phr.", def: "å¿…é ˆ", sentence: "Before the typhoon comes, we have to prepare enough food and save water.", trans: "åœ¨é¢±é¢¨ä¾†è‡¨ä¹‹å‰ï¼Œæˆ‘å€‘å¿…é ˆæº–å‚™è¶³å¤ çš„é£Ÿç‰©ä¸¦å„²æ°´ã€‚", emoji: "ğŸ“‹" },
      { word: "go out", kk: "[Íµgo Ë‹aÊŠt]", pos: "phr.", def: "ç†„æ»…", sentence: "The fire finally went out with the help of the rescue team.", trans: "åœ¨æ•‘æ´éšŠçš„å¹«åŠ©ä¸‹ï¼Œå¤§ç«çµ‚æ–¼ç†„æ»…äº†ã€‚", emoji: "ğŸ§¯" },
      { word: "train", kk: "[tren]", pos: "v.", def: "è¨“ç·´", sentence: "She trained hard to be a successful basketball player.", trans: "å¥¹åŠªåŠ›è¨“ç·´æˆç‚ºä¸€åæˆåŠŸçš„ç±ƒçƒå“¡ã€‚", emoji: "ğŸ‹ï¸" },
      { word: "face", kk: "[fes]", pos: "v.", def: "é¢å°", sentence: "Ron, you have to face the fear of spiders.", trans: "æ¦®æ©ï¼Œä½ å¿…é ˆé¢å°ä½ å°èœ˜è››çš„ææ‡¼ã€‚", emoji: "ğŸ˜¨" },
      { word: "try one's best", kk: "[Ë‹traÉª wÊŒnz Ë‹bÉ›st]", pos: "phr.", def: "ç›¡åŠ›è€Œç‚º", sentence: "The doctor tried her best to save the dying man.", trans: "é€™ä½é†«ç”Ÿç›¡å…¨åŠ›æŒ½æ•‘é‚£ä½å‚æ­»çš„ç”·å£«ã€‚", emoji: "ğŸ”¥" },
      { word: "turn on", kk: "[ÍµtÉn Ë‹É‘n]", pos: "phr.", def: "æ‰“é–‹ï¼ˆé›»æºï¼‰", sentence: "The boy turned on the TV right after he got back home.", trans: "ç”·å­©ä¸€å›åˆ°å®¶å¾Œé¦¬ä¸Šå°±æ‰“é–‹äº†é›»è¦–ã€‚", emoji: "ğŸ“º" },
      { word: "latest", kk: "[Ë‹letÉªst]", pos: "adj.", def: "æœ€æ–°çš„", sentence: "The reporter is reporting the latest news on TV.", trans: "é€™ä½è¨˜è€…æ­£åœ¨é›»è¦–ä¸Šå ±å°æœ€æ–°çš„æ¶ˆæ¯ã€‚", emoji: "ğŸ†•" },
      { word: "as", kk: "[Ã¦z]", pos: "prep.", def: "ä½œç‚ºï¼›å¦‚åŒ", sentence: "Danny's father works as a taxi driver.", trans: "ä¸¹å°¼çš„çˆ¶è¦ªæ˜¯ä½è¨ˆç¨‹è»Šå¸æ©Ÿã€‚", emoji: "ğŸš•" },
      { word: "earthquake", kk: "[Ë‹ÉÎ¸Íµkwek]", pos: "n.", def: "åœ°éœ‡", sentence: "The big earthquake killed many people.", trans: "å¤§åœ°éœ‡ä½¿è¨±å¤šäººå–ªç”Ÿã€‚", emoji: "ğŸšï¸" },
      { word: "bravely", kk: "[Ë‹brevlÉª]", pos: "adv.", def: "å‹‡æ•¢åœ°", sentence: "The soldiers fight bravely for their country.", trans: "è»äººå€‘ç‚ºè‡ªå·±çš„åœ‹å®¶è‹±å‹‡å¥®æˆ°ã€‚", emoji: "âš”ï¸" },
      { word: "through", kk: "[Î¸ru]", pos: "prep.", def: "ç©¿è¶Š", sentence: "It's dangerous to walk through a rainforest in the dark.", trans: "åœ¨é»‘æš—ä¸­å¾’æ­¥ç©¿è¶Šé›¨æ—å¾ˆå±éšªã€‚", emoji: "ğŸŒ²" },
      { word: "sharp", kk: "[ÊƒÉ‘rp]", pos: "adj.", def: "å°–éŠ³çš„", sentence: "Be careful of the sharp knife. You may get hurt.", trans: "è¦å°å¿ƒé€™æŠŠé‹’åˆ©çš„åˆ€å­ã€‚ä½ å¯èƒ½æœƒå—å‚·ã€‚", emoji: "ğŸ”ª" },
      { word: "reach", kk: "[ritÊƒ]", pos: "v.", def: "åˆ°é”", sentence: "They climbed up the mountain and reached the top.", trans: "ä»–å€‘çˆ¬ä¸Šå±±ï¼Œåˆ°é”å±±é ‚ã€‚", emoji: "ğŸ" },
      { word: "space", kk: "[spes]", pos: "n.", def: "ç©ºé–“", sentence: "The concert was full of people. There was no space for more.", trans: "é€™å€‹éŸ³æ¨‚æœƒå……æ»¿äº†äººã€‚æ²’æœ‰ç©ºé–“å®¹ç´æ›´å¤šäººäº†ã€‚", emoji: "ğŸš€" },
      { word: "size", kk: "[saÉªz]", pos: "n.", def: "å¤§å°ï¼›å°ºå¯¸", sentence: "We wore the same size T-shirt.", trans: "æˆ‘å€‘ç©¿è‘—ç›¸åŒå°ºå¯¸çš„Tæ¤ã€‚", emoji: "ğŸ‘•" },
      { word: "times", kk: "[taÉªmz]", pos: "n.", def: "å€", sentence: "Ms. Johnson makes five times more money than Mr. Johnson.", trans: "å¼·æ£®å¤ªå¤ªè³ºçš„éŒ¢æ˜¯å¼·ç”Ÿå…ˆç”Ÿçš„äº”å€å¤šã€‚", emoji: "âœ–ï¸" }
    ]
  },
  5: {
    title: "Unit 5: All of the Food Stands Look Great",
    words: [
      { word: "although", kk: "[É”lË‹Ã°o]", pos: "conj.", def: "é›–ç„¶", sentence: "Although Mr. Mills doesn't feel good, he still came to work today.", trans: "é›–ç„¶ç±³çˆ¾æ–¯å…ˆç”Ÿä¸å¤ªèˆ’æœï¼Œä»–ä»Šå¤©ä»ç„¶ä¾†ä¸Šç­ã€‚", emoji: "ğŸ¤¨" },
      { word: "matter", kk: "[Ë‹mÃ¦tÉš]", pos: "n.", def: "å•é¡Œï¼›äº‹ä»¶", sentence: "A: What's the matter? You look tired. B: I didn't sleep well last night.", trans: "Aï¼šç™¼ç”Ÿä»€éº¼äº‹å—ï¼Ÿä½ çœ‹èµ·ä¾†å¥½ç´¯ã€‚ Bï¼šæˆ‘æ˜¨æ™šæ²’ç¡å¥½ã€‚", emoji: "â“" },
      { word: "sore throat", kk: "[Ë‹sÉ”r ÍµÎ¸rot]", pos: "n.", def: "å–‰åš¨ç—›", sentence: "You should see a doctor when you have a sore throat.", trans: "ç•¶ä½ å–‰åš¨ç—›æ™‚ï¼Œæ‡‰è©²è¦å»çœ‹é†«ç”Ÿã€‚", emoji: "ğŸ˜«" },
      { word: "explain", kk: "[ÉªkË‹splen]", pos: "v.", def: "è§£é‡‹", sentence: "It's difficult for me to explain the problem clearly.", trans: "è¦å°‡é€™å•é¡Œè§£é‡‹æ¸…æ¥šï¼Œå°æˆ‘ä¾†èªªå¾ˆå›°é›£ã€‚", emoji: "ğŸ—£ï¸" },
      { word: "cough", kk: "[kÉ”f]", pos: "v.; n.", def: "å’³å—½", sentence: "My grandma has a bad cough. She's taking the medicine now.", trans: "æˆ‘çš„ç¥–æ¯å’³å¾—å¾ˆåš´é‡ã€‚å¥¹æ­£åœ¨æœè—¥ã€‚", emoji: "ğŸ˜·" },
      { word: "probably", kk: "[Ë‹prÉ‘bÉ™blÉª]", pos: "adv.", def: "å¾ˆå¯èƒ½ï¼›å¤§æ¦‚", sentence: "There's too much traffic today. I will probably be late for work.", trans: "ä»Šå¤©äº¤é€šå£…å¡ã€‚æˆ‘å¯èƒ½ä¸Šç­æœƒé²åˆ°ã€‚", emoji: "ğŸ¤·" },
      { word: "take care of", kk: "[Íµtek Ë‹kÉ›r É™v]", pos: "phr.", def: "ç…§é¡§", sentence: "The nurses take good care of the mother and the baby.", trans: "è­·ç†äººå“¡å€‘å°‡é‚£åª½åª½å’Œå¬°å…’ç…§é¡§å¾—å¾ˆå¥½ã€‚", emoji: "ğŸ¤±" },
      { word: "noon", kk: "[nun]", pos: "n.", def: "ä¸­åˆ", sentence: "My mom goes to work at night and comes back home before noon.", trans: "æˆ‘åª½åª½æ™šä¸Šå»ä¸Šç­ï¼Œç„¶å¾Œä¸­åˆå‰å›å®¶ã€‚", emoji: "ğŸ•›" },
      { word: "both", kk: "[boÎ¸]", pos: "pron.", def: "å…©è€…ï¼ˆéƒ½ï¼‰", sentence: "I have two brothers. Both of them are on the baseball team.", trans: "æˆ‘æœ‰å…©å€‹å“¥å“¥ã€‚ä»–å€‘å…©å€‹éƒ½åœ¨æ£’çƒéšŠä¸Šã€‚", emoji: "âœŒï¸" },
      { word: "sick", kk: "[sÉªk]", pos: "adj.", def: "ç”Ÿç—…çš„", sentence: "I feel sick. Can you drive me to the hospital?", trans: "æˆ‘è¦ºå¾—æˆ‘ç”Ÿç—…äº†ã€‚ä½ å¯ä»¥è¼‰æˆ‘å»é†«é™¢å—ï¼Ÿ", emoji: "ğŸ¤’" },
      { word: "medicine", kk: "[Ë‹mÉ›dÉ™sá¹‡]", pos: "n.", def: "è—¥", sentence: "Children don't like to take medicine.", trans: "å°å­©å€‘ä¸å–œæ­¡åƒè—¥ã€‚", emoji: "ğŸ’Š" },
      { word: "example", kk: "[ÉªgË‹zÃ¦mp!]", pos: "n.", def: "ç¯„ä¾‹", sentence: "I know many of Vincent van Gogh's paintings. For example, Cafe Terrace at Night is a famous one.", trans: "æˆ‘çŸ¥é“å¾ˆå¤šæ–‡æ£®â€§æ¢µè°·çš„ç•«ä½œã€‚ä¾‹å¦‚ï¼Œã€Œ å¤œæ™šçš„éœ²å¤©å’–å•¡åº§ã€å°±æ˜¯å¾ˆè‘—åçš„ä¸€å¹…ç•«ã€‚", emoji: "ğŸ’¡" },
      { word: "honey", kk: "[Ë‹hÊŒnÉª]", pos: "n.", def: "èœ‚èœœ", sentence: "I would like to have some honey for my lemon tea.", trans: "æˆ‘æƒ³åŠ ä¸€äº›èœ‚èœœåœ¨æˆ‘çš„æª¸æª¬èŒ¶è£¡ã€‚", emoji: "ğŸ¯" },
      { word: "lemon", kk: "[Ë‹lÉ›mÉ™n]", pos: "n.", def: "æª¸æª¬", sentence: "Jessica stopped at a cake shop and looked at the lemon cake in the window.", trans: "æ½”è¥¿å¡åœ¨è›‹ç³•åº—å‰é¢é§è¶³ï¼Œä¸¦çœ‹è‘—æ«¥çª—è£¡çš„æª¸æª¬è›‹ç³•ã€‚", emoji: "ğŸ‹" },
      { word: "useful", kk: "[Ë‹jusfÉ™l]", pos: "adj.", def: "æœ‰ç”¨çš„", sentence: "I got some useful books on science from my dad.", trans: "æˆ‘å¾æˆ‘çš„çˆ¸çˆ¸é‚£æ‹¿åˆ°ä¸€äº›å¯¦ç”¨çš„ç§‘å­¸æ›¸ç±ã€‚", emoji: "ğŸ› ï¸" },
      { word: "stand", kk: "[stÃ¦nd]", pos: "n.", def: "æ”¤ä½", sentence: "There's an ice cream stand in the park. It sells my favorite ice cream.", trans: "å…¬åœ’è£¡æœ‰ä¸€å€‹å†°æ·‡æ·‹æ”¤ä½ã€‚å®ƒæœ‰è³£æˆ‘æœ€æ„›çš„å†°æ·‡æ·‹ã€‚", emoji: "ğŸª" },
      { word: "feel like", kk: "[Íµfil Ë‹laÉªk]", pos: "phr.", def: "æƒ³è¦", sentence: "I don't feel like cooking. Can we just go out for dinner? Can we just go out for dinner?", trans: "æˆ‘ä»Šå¤©ä¸æƒ³è¦ç…®é£¯ã€‚æˆ‘å€‘æ™šä¸Šå¯ä»¥å‡ºå»åƒæ™šé¤å—ï¼Ÿ", emoji: "ğŸ˜‹" },
      { word: "cold", kk: "[kold]", pos: "n.", def: "æ„Ÿå†’", sentence: "Some people catch a cold when seasons change.", trans: "å­£ç¯€è½‰è®Šæ™‚ï¼Œæœ‰äº›äººæœƒæ„Ÿå†’ã€‚", emoji: "ğŸ¤§" },
      { word: "well", kk: "[wÉ›l]", pos: "adj.", def: "å¥åº·çš„", sentence: "I'm not feeling well. My stomach hurts.", trans: "æˆ‘æ„Ÿè¦ºä¸å¤ªèˆ’æœã€‚æˆ‘è‚šå­ç—›ã€‚", emoji: "ğŸ’ª" },
      { word: "common", kk: "[Ë‹kÉ‘mÉ™n]", pos: "adj.", def: "å¸¸è¦‹çš„ï¼›å…±åŒçš„", sentence: "Forest fires are common in Australia in late January and early February.", trans: "åœ¨æ¾³æ´²ï¼Œä¸€æœˆåº•å’ŒäºŒæœˆåˆæ™‚æ£®æ—ç«ç½æ˜¯å¾ˆå¸¸è¦‹çš„ã€‚", emoji: "ğŸ”¥" },
      { word: "comfortable", kk: "[Ë‹kÊŒmfÉštÉ™b!]", pos: "adj.", def: "èˆ’é©çš„", sentence: "This pair of shoes is comfortable to wear.", trans: "é€™é›™é‹ç©¿èµ·ä¾†å¾ˆèˆ’æœã€‚", emoji: "ğŸ‘Ÿ" },
      { word: "actually", kk: "[Ë‹Ã¦ktÊƒÊŠÉ™lÉª]", pos: "adv.", def: "å¯¦éš›ä¸Š", sentence: "Actually, Julie and I are not close friends. We don't know much about each other.", trans: "äº‹å¯¦ä¸Šï¼ŒèŒ±è‰å’Œæˆ‘ä¸¦ä¸æ˜¯å¾ˆç†Ÿçš„æœ‹å‹ã€‚æˆ‘å€‘ä¸¦æ²’æœ‰å¾ˆäº†è§£å°æ–¹ã€‚", emoji: "â˜ï¸" },
      { word: "helpful", kk: "[Ë‹hÉ›lpfÉ™l]", pos: "adj.", def: "æœ‰å¹«åŠ©çš„", sentence: "Thanks for your idea. It's really helpful.", trans: "è¬è¬ä½ çš„æ„è¦‹ã€‚å®ƒçœŸçš„å¾ˆæœ‰å¹«åŠ©ã€‚", emoji: "ğŸ¤" },
      { word: "root", kk: "[rut]", pos: "n.", def: "æ ¹", sentence: "The roots of a tree can go deep into the ground.", trans: "æ¨¹æ ¹å¯ä»¥é•·åˆ°åœ°åº•æ·±è™•ã€‚", emoji: "ğŸŒ³" },
      { word: "reason", kk: "[Ë‹rizá¹‡]", pos: "n.", def: "åŸå› ï¼›ç†ç”±", sentence: "The woman sometimes feels sad for no reason.", trans: "é‚£å¥³å£«æœ‰æ™‚æœƒè«ååœ°æ„Ÿåˆ°æ‚²å‚·ã€‚", emoji: "ğŸ¤”" },
      { word: "must", kk: "[mÊŒst]", pos: "n.", def: "å¿…è¦çš„äº‹ç‰©", sentence: "When I see a movie, popcorn is a must.", trans: "æˆ‘çœ‹é›»å½±æ™‚ï¼Œçˆ†ç±³èŠ±ä¸€å®šæ˜¯å¿…å‚™çš„ã€‚", emoji: "ğŸ¿" },
      { word: "under the weather", kk: "[ÍµÊŒndÉš Ã°É™ Ë‹wÉ›Ã°Éš]", pos: "phr.", def: "èº«é«”ä¸èˆ’æœ", sentence: "I am under the weather. I need to take a rest.", trans: "æˆ‘èº«é«”ä¸èˆ’æœã€‚æˆ‘éœ€è¦ä¼‘æ¯ä¸€ä¸‹ã€‚", emoji: "ğŸŒ§ï¸" },
      { word: "treat", kk: "[trit]", pos: "v.", def: "æ²»ç™‚", sentence: "The medicine couldn't treat her headache.", trans: "é€™å€‹è—¥æ²’è¾¦æ³•æ²»ç™‚å¥¹çš„é ­ç—›ã€‚", emoji: "ğŸ©º" }
    ]
  },
  6: {
    title: "Unit 6: You Can Throw a Ball, Can't You?",
    words: [
      { word: "pass", kk: "[pÃ¦s]", pos: "v.", def: "å‚³é", sentence: "Could you pass the salt, please?", trans: "èƒ½éº»ç…©ä½ éé¹½çµ¦æˆ‘å—ï¼Ÿ", emoji: "ğŸ«´" },
      { word: "throw", kk: "[Î¸ro]", pos: "v.", def: "ä¸Ÿï¼›æŠ•æ“²", sentence: "The little boy threw something out of the window.", trans: "é‚£å°ç”·å­©ä¸Ÿæ±è¥¿å‡ºçª—å¤–ã€‚", emoji: "ğŸ¥" },
      { word: "point", kk: "[pÉ”Éªnt]", pos: "n.", def: "å¾—åˆ†", sentence: "David got the most points in the game.", trans: "å¤§è¡›åœ¨æ¯”è³½è£¡å¾—åˆ°æœ€å¤šåˆ†ã€‚", emoji: "ğŸ”¢" },
      { word: "win", kk: "[wÉªn]", pos: "v.", def: "è´ï¼›ç²å‹", sentence: "I believe that we'll win the game if we practice harder.", trans: "å¦‚æœæˆ‘å€‘åŠªåŠ›ç·´ç¿’ï¼Œæˆ‘ç›¸ä¿¡æˆ‘å€‘å°±èƒ½è´å¾—æ¯”è³½ã€‚", emoji: "ğŸ†" },
      { word: "group", kk: "[grup]", pos: "n.", def: "åœ˜é«”", sentence: "Lily and I work in the same group in the English club.", trans: "è‰è‰å’Œæˆ‘åœ¨è‹±èªç¤¾çš„åŒçµ„å·¥ä½œã€‚", emoji: "ğŸ‘¥" },
      { word: "grade", kk: "[gred]", pos: "n.", def: "æˆç¸¾", sentence: "Joe always gets good grades in science.", trans: "å–¬ç¸½æ˜¯åœ¨ç§‘å­¸æ‹¿é«˜åˆ†ã€‚", emoji: "ğŸ…°ï¸" },
      { word: "fail", kk: "[fel]", pos: "v.", def: "è€ƒä¸åŠæ ¼ï¼›å¤±æ•—", sentence: "Many of the students in my class failed math.", trans: "æˆ‘ç­ä¸Šå¾ˆå¤šå­¸ç”Ÿæ•¸å­¸ä¸åŠæ ¼ã€‚", emoji: "âŒ" },
      { word: "test", kk: "[tÉ›st]", pos: "n.", def: "è€ƒè©¦", sentence: "Tiffany studied hard for the test.", trans: "è’‚èŠ¬å¦®ç‚ºäº†è€ƒè©¦ç”¨åŠŸè®€æ›¸ã€‚", emoji: "ğŸ“" },
      { word: "afraid", kk: "[É™Ë‹fred]", pos: "adj.", def: "å®³æ€•çš„ï¼›æ“”æ†‚çš„", sentence: "Rita is afraid of speaking in front of people.", trans: "ç‘å¡”å®³æ€•åœ¨äººç¾¤å‰èªªè©±ã€‚", emoji: "ğŸ˜¨" },
      { word: "smart", kk: "[smÉ‘rt]", pos: "adj.", def: "è°æ˜çš„", sentence: "Hank is really a smart guy. He does well in every subject.", trans: "æ¼¢å…‹çœŸçš„æ˜¯å€‹å¾ˆè°æ˜çš„äººã€‚ä»–æ¯ä¸€ç§‘éƒ½è¡¨ç¾å¾—å¾ˆå¥½ã€‚", emoji: "ğŸ§ " },
      { word: "count... in", kk: "[kaÊŠnt Ë‹Éªn]", pos: "phr.", def: "ç®—...åƒåŠ ä¸€ä»½", sentence: "A: We plan to go to the USA for holidays. Would you like to join us? B: Sure. Count me in.", trans: "Aï¼šæˆ‘å€‘è¨ˆåŠƒå»ç¾åœ‹åº¦å‡ã€‚ä½ æƒ³åŠ å…¥æˆ‘å€‘å—ï¼Ÿ Bï¼šç•¶ç„¶ã€‚ç®—æˆ‘ä¸€ä»½ã€‚", emoji: "ğŸ™‹" },
      { word: "begin", kk: "[bÉªË‹gÉªn]", pos: "v.", def: "é–‹å§‹", sentence: "Ted began learning English two years ago.", trans: "æ³°å¾·å…©å¹´å‰é–‹å§‹å­¸è‹±æ–‡ã€‚", emoji: "ğŸ" },
      { word: "meeting", kk: "[Ë‹mitÉªÅ‹]", pos: "n.", def: "æœƒè­°ï¼›æœƒé¢", sentence: "We'll have a meeting with the boss this afternoon.", trans: "æˆ‘å€‘ä¸‹åˆå’Œè€é—†æœ‰å€‹æœƒè­°ã€‚", emoji: "ğŸ¤" },
      { word: "come on", kk: "[ÍµkÊŒm Ë‹É‘n]", pos: "phr.", def: "å¿«é»ï¼›å°‘ä¾†äº†", sentence: "Come on, Sandy. Show me your work.", trans: "å¿«é»ï¼ŒçŠè’‚ã€‚çµ¦æˆ‘çœ‹ä½ çš„ä½œå“ã€‚", emoji: "ğŸƒ" },
      { word: "excuse", kk: "[ÉªkË‹skjuz]", pos: "n.", def: "è—‰å£ï¼›ç†ç”±", sentence: "Don't make an excuse for your mistake.", trans: "ä¸è¦ç‚ºä½ çš„éŒ¯èª¤æ‰¾è—‰å£ã€‚", emoji: "ğŸ¤¥" },
      { word: "around the corner", kk: "[É™ÍµraÊŠnd Ã°É™ Ë‹kÉ”rnÉš]", pos: "phr.", def: "å³å°‡ä¾†è‡¨ï¼›åœ¨é™„è¿‘", sentence: "Christmas is around the corner.", trans: "è–èª•ç¯€å°±å¿«åˆ°ä¾†ã€‚", emoji: "ğŸ„" },
      { word: "hold back", kk: "[Íµhold Ë‹bÃ¦k]", pos: "phr.", def: "é˜»ç¤™", sentence: "Don't worry. I believe nothing can hold you back.", trans: "åˆ¥æ“”å¿ƒã€‚æˆ‘ç›¸ä¿¡æ²’æœ‰äº‹æƒ…æœƒé˜»ç¤™ä½ ã€‚", emoji: "ğŸš«" },
      { word: "bring", kk: "[brÉªÅ‹]", pos: "v.", def: "å¸¶ä¾†ï¼›æ”œå¸¶", sentence: "Did you bring anything to eat? I'm so hungry.", trans: "ä½ æœ‰å¸¶æ±è¥¿ä¾†åƒå—ï¼Ÿæˆ‘å¥½é¤“ã€‚", emoji: "ğŸ¥¡" },
      { word: "honest", kk: "[Ë‹É‘nÉªst]", pos: "adj.", def: "èª å¯¦çš„ï¼›å¯ä¿¡çš„", sentence: "To be honest, the writer's new book is worse than the last one.", trans: "è€å¯¦èªªï¼Œé€™ä½œå®¶çš„æ–°æ›¸æ¯”ä¸Šä¸€æœ¬é‚„ç³Ÿã€‚", emoji: "ğŸ˜‡" },
      { word: "lead to", kk: "[Ë‹lid tÉ™]", pos: "phr.", def: "å°è‡´", sentence: "Eating too much fast food may lead to health problems.", trans: "åƒå¤ªå¤šé€Ÿé£Ÿå¯èƒ½æœƒé€ æˆå¥åº·å•é¡Œã€‚", emoji: "ğŸ”" },
      { word: "push", kk: "[pÊŠÊƒ]", pos: "v.", def: "è¿«ä½¿ï¼›æ¨å‹•", sentence: "The boss pushed the workers to work for long hours.", trans: "è€é—†é€¼è¿«å·¥äººå€‘é•·æ™‚é–“çš„å·¥ä½œã€‚", emoji: "ğŸ˜¤" },
      { word: "excellent", kk: "[Ë‹É›ks!É™nt]", pos: "adj.", def: "å„ªç§€çš„ï¼›æ¥µä½³çš„", sentence: "Michael Phelps is an excellent swimmer.", trans: "éº¥å¯ï¼è²»çˆ¾æ™®æ–¯æ˜¯åå„ªç§€çš„æ³³è€…ã€‚", emoji: "ğŸ¥‡" },
      { word: "be able to", kk: "[bÉªË‹eb! tÉ™]", pos: "phr.", def: "èƒ½å¤ ", sentence: "Vivian won't be able to come today. Her mother died in the early morning.", trans: "è–‡è–‡å®‰ä»Šå¤©ç„¡æ³•å‰ä¾†ã€‚å¥¹åª½åª½ä»Šæ—©éä¸–äº†ã€‚", emoji: "ğŸ’ª" },
      { word: "define", kk: "[dÉªË‹faÉªn]", pos: "v.", def: "ä¸‹å®šç¾©ï¼›ç•Œå®š", sentence: "Don't let others define you. Just be yourself. Just be yourself.", trans: "ä¸è¦è®“ä»–äººç•Œå®šä½ ã€‚åšè‡ªå·±å°±å¥½ã€‚", emoji: "ğŸ“–" },
      { word: "matter", kk: "[Ë‹mÃ¦tÉš]", pos: "v.", def: "è¦ç·Šï¼›é‡è¦", sentence: "A: What's the matter? B: It doesn't matter now.", trans: "Aï¼šä½ æ—©ä¸Šæƒ³å‘Šè¨´æˆ‘ä»€éº¼ï¼Ÿ Bï¼šä¸é‡è¦äº†ã€‚", emoji: "ğŸ¤·â€â™‚ï¸" },
      { word: "picture", kk: "[Ë‹pÉªktÊƒÉš]", pos: "v.", def: "æƒ³åƒ", sentence: "Try to picture that you are in a rainforest. What do you see there?", trans: "è©¦è‘—æƒ³åƒä½ åœ¨é›¨æ—è£¡ã€‚ä½ åœ¨é‚£çœ‹åˆ°äº†ä»€éº¼ï¼Ÿ", emoji: "ğŸ’­" },
      { word: "as for", kk: "[Ë‹Ã¦z fÉš]", pos: "phr.", def: "è‡³æ–¼", sentence: "The food in this restaurant is good. As for the service, it's bad.", trans: "é€™é¤å»³çš„é£Ÿç‰©å¾ˆæ£’ã€‚è‡³æ–¼æœå‹™ï¼Œå¾ˆç³Ÿã€‚", emoji: "ğŸ‘‰" },
      { word: "to the full", kk: "[tÉ™ Ã°É™ Ë‹fÊŠl]", pos: "phr.", def: "ç›¡å¯èƒ½", sentence: "Life is short. You should enjoy it to the full.", trans: "äººç”Ÿå¾ˆçŸ­æš«ã€‚ä½ æ‡‰è©²ç›¡æƒ…çš„äº«å—å®ƒã€‚", emoji: "ğŸ”‹" }
    ]
  }
};

// æ–‡å­—è½‰èªéŸ³åŠŸèƒ½ (ä¿æŒä¸è®Š)
const speak = (text) => {
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    window.speechSynthesis.speak(utterance);
  }
};

// è¼”åŠ©å‡½å¼ï¼šç”¢ç”Ÿé¸é …
const generateOptionsForWord = (targetWord, fullList) => {
  if (!targetWord || !fullList) return [];
  const wrongOptions = fullList
    .filter(item => item.word !== targetWord.word)
    .sort(() => 0.5 - Math.random())
    .slice(0, 3)
    .map(item => item.def);
  
  return [...wrongOptions, targetWord.def].sort(() => 0.5 - Math.random());
};

const App = () => {
  const [currentTab, setCurrentTab] = useState('study'); // 'study' or 'quiz'
  const [currentUnitId, setCurrentUnitId] = useState(3); // é è¨­ç¬¬3å–®å…ƒ
  const [flippedCards, setFlippedCards] = useState({});

  const currentUnitData = textbookData[currentUnitId];

  // åˆ‡æ›å–®å…ƒæ™‚é‡ç½®ç¿»å¡ç‹€æ…‹
  useEffect(() => {
    setFlippedCards({});
  }, [currentUnitId]);

  const toggleFlip = (index) => {
    setFlippedCards(prev => ({
      ...prev,
      [index]: !prev[index]
    }));
  };

  return (
    <div className="min-h-screen bg-slate-50 text-slate-800 font-sans selection:bg-indigo-200 flex flex-col">
      
      {/* é ‚éƒ¨å°è¦½åˆ— */}
      <header className="bg-indigo-600 text-white shadow-lg sticky top-0 z-50">
        <div className="max-w-6xl mx-auto px-4 py-4">
          <div className="flex justify-between items-center mb-4">
            <div>
              <h1 className="text-2xl font-bold flex items-center gap-2">
                <BookOpen className="w-8 h-8" />
                åœ‹äºŒè‹±èªå–®å­—ç‰¹è¨“
              </h1>
              <p className="text-indigo-200 text-sm hidden sm:block">Current: {currentUnitData.title}</p>
            </div>
            
            <div className="flex bg-indigo-800 rounded-lg p-1">
              <button
                onClick={() => setCurrentTab('study')}
                className={`px-4 py-2 rounded-md flex items-center gap-2 transition-all ${currentTab === 'study' ? 'bg-white text-indigo-700 shadow-sm' : 'text-indigo-200 hover:text-white'}`}
              >
                <BookOpen size={18} />
                <span className="font-medium hidden sm:inline">å­¸ç¿’</span>
              </button>
              <button
                onClick={() => setCurrentTab('quiz')}
                className={`px-4 py-2 rounded-md flex items-center gap-2 transition-all ${currentTab === 'quiz' ? 'bg-white text-indigo-700 shadow-sm' : 'text-indigo-200 hover:text-white'}`}
              >
                <Brain size={18} />
                <span className="font-medium hidden sm:inline">æ¸¬é©—</span>
              </button>
            </div>
          </div>

          {/* å–®å…ƒé¸æ“‡å™¨ (åªé¡¯ç¤º Unit 3-6) */}
          <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
            {[3, 4, 5, 6].map((unitId) => (
              <button
                key={unitId}
                onClick={() => setCurrentUnitId(unitId)}
                className={`whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium transition-colors border ${
                  currentUnitId === unitId 
                    ? 'bg-white text-indigo-600 border-white' 
                    : 'bg-indigo-700 text-indigo-100 border-indigo-600 hover:bg-indigo-500'
                }`}
              >
                Unit {unitId}
              </button>
            ))}
          </div>
        </div>
      </header>

      {/* ä¸»è¦å…§å®¹å€ */}
      <main className="max-w-6xl mx-auto px-4 py-8 flex-grow w-full">
        
        {currentTab === 'study' && (
          <div className="animate-fade-in">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-xl font-bold text-slate-700 flex items-center gap-2">
                <LayoutGrid size={24} className="text-indigo-500"/>
                {currentUnitData.title}
              </h2>
              <span className="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold">
                {currentUnitData.words.length} Words
              </span>
            </div>
            
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {currentUnitData.words.map((item, index) => (
                <div 
                  key={`${currentUnitId}-${index}`} // Add unitId to key to force re-render on unit change
                  className="group relative h-72 w-full perspective-1000 cursor-pointer"
                  onClick={() => toggleFlip(index)}
                >
                  <div className={`relative w-full h-full duration-500 preserve-3d transition-transform shadow-xl rounded-2xl ${flippedCards[index] ? 'rotate-y-180' : ''}`}>
                    
                    {/* æ­£é¢ */}
                    <div className="absolute w-full h-full backface-hidden bg-white rounded-2xl p-6 flex flex-col items-center justify-center border-2 border-indigo-50 hover:border-indigo-200 transition-colors">
                      <div className="text-6xl mb-4 transform group-hover:scale-110 transition-transform">{item.emoji}</div>
                      <h3 className="text-3xl font-bold text-slate-800 mb-1">{item.word}</h3>
                      <div className="flex items-center gap-2 mb-4">
                        <span className="text-slate-500 font-mono text-sm bg-slate-100 px-2 py-1 rounded">{item.kk}</span>
                        <span className="text-indigo-600 font-bold text-sm bg-indigo-50 px-2 py-1 rounded">{item.pos}</span>
                      </div>
                      <button 
                        onClick={(e) => {
                          e.stopPropagation();
                          speak(item.word);
                        }}
                        className="mt-2 p-3 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 rounded-full transition-colors flex items-center gap-2"
                        title="æ’­æ”¾ç™¼éŸ³"
                      >
                        <Volume2 size={20} />
                      </button>
                      <p className="absolute bottom-4 text-xs text-slate-400">é»æ“ŠæŸ¥çœ‹æ„æ€</p>
                    </div>

                    {/* èƒŒé¢ */}
                    <div className="absolute w-full h-full backface-hidden bg-gradient-to-br from-indigo-600 to-indigo-800 text-white rounded-2xl p-6 rotate-y-180 flex flex-col justify-center overflow-y-auto">
                      <div className="text-center mb-4">
                        <h4 className="text-2xl font-bold mb-1">{item.def}</h4>
                      </div>
                      <div className="bg-white/10 rounded-lg p-3 backdrop-blur-sm">
                        <p className="text-sm font-medium mb-2 leading-relaxed opacity-90">{item.sentence}</p>
                        <p className="text-xs text-indigo-200 border-t border-indigo-400/30 pt-2">{item.trans}</p>
                      </div>
                      <button 
                        onClick={(e) => {
                          e.stopPropagation();
                          speak(item.sentence);
                        }}
                        className="mt-4 self-center p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors"
                        title="æœ—è®€ä¾‹å¥"
                      >
                        <Volume2 size={16} />
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {currentTab === 'quiz' && (
          <QuizMode words={currentUnitData.words} />
        )}

      </main>

      <footer className="text-center py-8 text-slate-400 text-sm">
        <p>Keep going! æ¯å¤©é€²æ­¥ä¸€é»é»ï¼Œä½ å°±æœƒè®Šå¾—å¾ˆå²å®³ï¼</p>
      </footer>
    </div>
  );
};

// å„ªåŒ–å¾Œçš„æ¸¬é©—çµ„ä»¶
const QuizMode = ({ words }) => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [score, setScore] = useState(0);
  const [showScore, setShowScore] = useState(false);
  const [selectedOption, setSelectedOption] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);
  const [shuffledQuestions, setShuffledQuestions] = useState([]);
  const [currentOptions, setCurrentOptions] = useState([]);

  // åˆå§‹åŒ–æ¸¬é©—
  useEffect(() => {
    startNewQuiz();
  }, [words]); // ç•¶å–®å­—åˆ—è¡¨æ”¹è®Š(åˆ‡æ›å–®å…ƒ)æ™‚é‡ç½®

  const startNewQuiz = useCallback(() => {
    if (!words || words.length === 0) return;
    const shuffled = [...words].sort(() => 0.5 - Math.random());
    setShuffledQuestions(shuffled);
    setCurrentQuestion(0);
    setScore(0);
    setShowScore(false);
    setSelectedOption(null);
    setIsCorrect(null);
    
    if (shuffled.length > 0) {
      setCurrentOptions(generateOptionsForWord(shuffled[0], words));
    }
  }, [words]);

  const handleAnswerClick = (option, correctWord) => {
    if (selectedOption) return;

    setSelectedOption(option);
    const correct = option === correctWord;
    setIsCorrect(correct);

    if (correct) {
      setScore(prev => prev + 1);
      speak("Correct!");
    } else {
      speak("Try again.");
    }
  };

  const nextQuestion = () => {
    const nextQ = currentQuestion + 1;
    if (nextQ < shuffledQuestions.length) {
      setSelectedOption(null);
      setIsCorrect(null);
      setCurrentQuestion(nextQ);
      setCurrentOptions(generateOptionsForWord(shuffledQuestions[nextQ], words));
    } else {
      setShowScore(true);
    }
  };

  if (shuffledQuestions.length === 0) return (
    <div className="flex justify-center items-center h-64 text-slate-500">
      <RotateCw className="animate-spin mr-2" /> æº–å‚™é¡Œç›®ä¸­...
    </div>
  );

  const currentWord = shuffledQuestions[currentQuestion];
  
  if (currentOptions.length === 0 && currentWord) {
     setCurrentOptions(generateOptionsForWord(currentWord, words));
     return null;
  }

  return (
    <div className="max-w-2xl mx-auto animate-fade-in">
      {showScore ? (
        <div className="bg-white rounded-2xl shadow-xl p-8 text-center">
          <Trophy className="w-20 h-20 text-yellow-500 mx-auto mb-4" />
          <h2 className="text-3xl font-bold text-slate-800 mb-2">å–®å…ƒæ¸¬é©—å®Œæˆï¼</h2>
          <p className="text-slate-600 mb-6">ä½ çš„åˆ†æ•¸æ˜¯</p>
          <div className="text-6xl font-black text-indigo-600 mb-6">
            {score} / {words.length}
          </div>
          <p className="mb-8 text-lg">
            {score === words.length ? "Perfect! é€™å€‹å–®å…ƒä½ å·²ç¶“å®Œå…¨æŒæ¡äº†ï¼ğŸ‰" : 
             score > words.length * 0.8 ? "å¾ˆæ£’å–”ï¼ç¹¼çºŒä¿æŒï¼ğŸ”¥" : 
             "å†å¤šç·´ç¿’å¹¾æ¬¡å°±æœƒäº†ï¼ğŸ’ª"}
          </p>
          <button 
            onClick={startNewQuiz}
            className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full transition-colors flex items-center gap-2 mx-auto"
          >
            <RotateCw size={20} />
            é‡æ¸¬æœ¬å–®å…ƒ
          </button>
        </div>
      ) : (
        <div className="bg-white rounded-2xl shadow-xl p-6 md:p-10 relative overflow-hidden">
          {/* é€²åº¦æ¢ */}
          <div className="absolute top-0 left-0 w-full h-2 bg-slate-100">
            <div 
              className="h-full bg-indigo-500 transition-all duration-300"
              style={{ width: `${((currentQuestion + 1) / shuffledQuestions.length) * 100}%` }}
            ></div>
          </div>

          <div className="flex justify-between items-center mb-8 mt-2">
            <span className="text-slate-400 font-medium">Question {currentQuestion + 1}/{shuffledQuestions.length}</span>
            <span className="bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-sm font-bold">Score: {score}</span>
          </div>

          <div className="text-center mb-10">
            <div className="text-6xl mb-4">{currentWord.emoji}</div>
            <h2 className="text-4xl font-bold text-slate-800 mb-2">{currentWord.word}</h2>
            <button 
              onClick={() => speak(currentWord.word)}
              className="inline-flex items-center gap-2 text-indigo-600 bg-indigo-50 hover:bg-indigo-100 px-3 py-1 rounded-full text-sm transition-colors"
            >
              <Volume2 size={16} /> è½ç™¼éŸ³
            </button>
          </div>

          <div className="grid grid-cols-1 gap-3">
            {currentOptions.map((option, index) => {
              let buttonStyle = "border-2 border-slate-200 hover:border-indigo-300 hover:bg-indigo-50 text-slate-700";
              
              if (selectedOption) {
                if (option === currentWord.def) {
                  buttonStyle = "border-2 border-green-500 bg-green-50 text-green-700";
                } else if (option === selectedOption && option !== currentWord.def) {
                  buttonStyle = "border-2 border-red-500 bg-red-50 text-red-700";
                } else {
                  buttonStyle = "border-2 border-slate-100 text-slate-300 opacity-50";
                }
              }

              return (
                <button
                  key={option}
                  onClick={() => handleAnswerClick(option, currentWord.def)}
                  disabled={!!selectedOption}
                  className={`p-4 rounded-xl text-lg font-medium transition-all duration-200 text-left flex justify-between items-center ${buttonStyle}`}
                >
                  {option}
                  {selectedOption && option === currentWord.def && <CheckCircle className="text-green-500" />}
                  {selectedOption && option === selectedOption && option !== currentWord.def && <XCircle className="text-red-500" />}
                </button>
              );
            })}
          </div>

          {selectedOption && (
            <div className="mt-8 flex justify-center animate-bounce-in">
              <button
                onClick={nextQuestion}
                className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transition-all transform hover:scale-105 flex items-center gap-2"
              >
                {currentQuestion === shuffledQuestions.length - 1 ? 'æŸ¥çœ‹çµæœ' : 'ä¸‹ä¸€é¡Œ'}
                <ArrowRight size={20} />
              </button>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

// CSS (ä¿æŒä¸è®Š)
const style = document.createElement('style');
style.textContent = `
  .perspective-1000 {
    perspective: 1000px;
  }
  .preserve-3d {
    transform-style: preserve-3d;
  }
  .backface-hidden {
    backface-visibility: hidden;
  }
  .rotate-y-180 {
    transform: rotateY(180deg);
  }
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in {
    animation: fade-in 0.5s ease-out forwards;
  }
  /* éš±è— Scrollbar ä½†ä¿æŒæ»¾å‹•åŠŸèƒ½ (Chrome/Safari/Webkit) */
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  /* éš±è— Scrollbar (IE/Edge/Firefox) */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
`;
document.head.appendChild(style);

export default App;